<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Teste - Email de Exemplo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Carrega CSS individuais na ordem correta -->
    <link rel="stylesheet" href="css/reset.css" />
    <link rel="stylesheet" href="css/variables.css" />
    <link rel="stylesheet" href="css/utilities.css" />
    <link rel="stylesheet" href="css/layout.css" />
    <link rel="stylesheet" href="css/components.css" />
    <link rel="stylesheet" href="css/animations.css" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <header class="header">
        <div class="header-icon">
          <i class="fas fa-robot"></i>
        </div>
        <h1>Teste - Email de Exemplo</h1>
        <p>Testando o email especÃ­fico que estÃ¡ dando problema</p>
      </header>

      <main class="content">
        <div class="form-group">
          <label class="form-label">
            <i class="fas fa-edit"></i>
            Email de teste:
          </label>
          <div class="textarea-container">
            <textarea
              id="email-textarea"
              class="form-textarea"
              placeholder="Digite o email aqui..."
              rows="8"
            >
Oi pessoal,

SÃ³ passando para desejar um Feliz Natal e Ã³timas festas a todos! Que 2026 venha cheio de realizaÃ§Ãµes ğŸ™‚

AbraÃ§os,
Carlos</textarea
            >
            <div class="char-counter">
              <span id="char-count">0</span> caracteres
            </div>
          </div>
        </div>

        <!-- BotÃ£o de teste -->
        <button type="submit" class="btn-primary" id="submit-btn">
          <span class="btn-text">Classificar Email</span>
          <span class="btn-icon">
            <i class="fas fa-paper-plane"></i>
          </span>
        </button>

        <!-- Resultado do teste -->
        <div
          id="test-result"
          class="result-container"
          style="display: none; margin-top: 2rem"
        >
          <div class="result-content">
            <h3 id="result-title">Resultado da ClassificaÃ§Ã£o</h3>
            <p id="result-message">Aguardando resultado...</p>
          </div>
        </div>

        <!-- InstruÃ§Ãµes -->
        <div
          style="
            margin-top: 3rem;
            padding: 1.5rem;
            background: var(--gray-50);
            border-radius: var(--radius-lg);
          "
        >
          <h3>ğŸ“‹ InstruÃ§Ãµes para o Teste:</h3>
          <ol style="margin-top: 1rem; line-height: 1.6">
            <li>
              <strong>Abra o Console do Navegador</strong> (F12 â†’ Console)
            </li>
            <li><strong>Clique no botÃ£o "Classificar Email"</strong> acima</li>
            <li><strong>Observe os logs no console</strong> que mostrarÃ£o:</li>
            <ul style="margin-top: 0.5rem; margin-left: 1rem">
              <li>ğŸ¤– Resposta completa da API</li>
              <li>ğŸ“Š Categoria retornada</li>
              <li>ğŸ¯ Prioridade retornada</li>
              <li>ğŸ“ Texto enviado</li>
              <li>ğŸ“ Tamanho do texto</li>
              <li>âš™ï¸ Processo de validaÃ§Ã£o</li>
            </ul>
            <li><strong>Copie os logs</strong> e envie para anÃ¡lise</li>
          </ol>
        </div>
      </main>
    </div>

    <script type="module">
      import { DOMManager } from "./js/dom.js";
      import { AppState } from "./js/state.js";
      import { UIManager } from "./js/ui.js";
      import { HistoryManager } from "./js/history.js";
      import { APIManager } from "./js/api.js";
      import { FileHandler } from "./js/file-handler.js";
      import { TabManager } from "./js/tabs.js";
      import { Utils } from "./js/utils.js";
      import { TOAST_TYPES } from "./js/config.js";

      // Inicializar componentes
      const dom = new DOMManager();
      const state = new AppState();
      const ui = new UIManager(dom, state);
      const history = new HistoryManager(dom);
      const api = new APIManager();
      const fileHandler = new FileHandler(dom, ui);
      const tabManager = new TabManager(dom, fileHandler);

      // Atualizar contador de caracteres
      function updateCharCount() {
        const textarea = document.getElementById("email-textarea");
        const charCount = document.getElementById("char-count");
        const count = textarea.value.length;
        charCount.textContent = count;

        // Colorir baseado no tamanho
        charCount.className = "char-counter";
        if (count < 10) {
          charCount.classList.add("text-red-600");
        } else if (count < 50) {
          charCount.classList.add("text-yellow-500");
        } else {
          charCount.classList.add("text-green-600");
        }
      }

      // Event listener para o botÃ£o
      document
        .getElementById("submit-btn")
        .addEventListener("click", async function (e) {
          e.preventDefault();

          const textContent = document
            .getElementById("email-textarea")
            .value.trim();
          console.log("ğŸš€ Iniciando classificaÃ§Ã£o do email...");
          console.log("ğŸ“§ Email completo:", textContent);
          console.log("ğŸ“ Tamanho:", textContent.length, "caracteres");

          // Mostrar loading
          ui.showLoading();

          try {
            // ValidaÃ§Ã£o
            console.log("ğŸ” Iniciando validaÃ§Ã£o...");
            const validation = Utils.validateEmail(textContent, null);
            console.log("âœ… Resultado da validaÃ§Ã£o:", validation);

            if (!validation.valid) {
              console.log("âŒ ValidaÃ§Ã£o falhou:", validation.message);
              ui.showError(validation.message);
              return;
            }

            console.log("âœ… ValidaÃ§Ã£o passou, prosseguindo...");

            // Preparar dados
            const formData = api.createFormData(
              textContent,
              null,
              false,
              false
            );
            console.log("ğŸ“¦ FormData preparado:", formData);

            // Fazer requisiÃ§Ã£o
            console.log("ğŸŒ Enviando requisiÃ§Ã£o para API...");
            const data = await api.classifyEmail(formData);

            // Log detalhado da resposta da API
            console.log("ğŸ¤– Resposta completa da API:", data);
            console.log("ğŸ“Š Categoria retornada:", data.categoria);
            console.log("ğŸ¯ Prioridade retornada:", data.prioridade);
            console.log("ğŸ“ Texto enviado:", textContent);
            console.log(
              "ğŸ“ Tamanho do texto:",
              textContent ? textContent.length : "N/A"
            );

            // Processar resultado
            const resultDiv = document.getElementById("test-result");
            const resultTitle = document.getElementById("result-title");
            const resultMessage = document.getElementById("result-message");

            resultDiv.style.display = "block";

            if (data.error) {
              console.log("âŒ Erro detectado:", data.error);
              resultTitle.textContent = "âŒ Erro";
              resultMessage.textContent = data.error;
              resultDiv.querySelector(".result-content").className =
                "result-content result-error";
            } else if (
              data.categoria === null ||
              data.categoria === undefined ||
              data.categoria === ""
            ) {
              console.log("âš ï¸ Categoria nula/indefinida detectada");
              console.log("ğŸ“‹ Dados recebidos:", JSON.stringify(data, null, 2));
              resultTitle.textContent = "âš ï¸ ClassificaÃ§Ã£o Inconclusiva";
              resultMessage.textContent =
                "NÃ£o foi possÃ­vel classificar este email com confianÃ§a suficiente. Verifique os logs no console para mais detalhes.";
              resultDiv.querySelector(".result-content").className =
                "result-content result-warning";
            } else {
              console.log("âœ… ClassificaÃ§Ã£o bem-sucedida!");
              console.log("ğŸ“Š Categoria final:", data.categoria);
              console.log("ğŸ¯ Prioridade final:", data.prioridade);

              resultTitle.textContent = `âœ… Classificado como: ${data.categoria}`;
              resultMessage.textContent = `Prioridade: ${data.prioridade}`;
              resultDiv.querySelector(".result-content").className =
                "result-content result-success";
            }
          } catch (error) {
            console.error("âŒ Erro capturado:", error);
            console.error("ğŸ“‹ Detalhes do erro:", {
              name: error.name,
              message: error.message,
              stack: error.stack,
            });

            const resultDiv = document.getElementById("test-result");
            const resultTitle = document.getElementById("result-title");
            const resultMessage = document.getElementById("result-message");

            resultDiv.style.display = "block";
            resultTitle.textContent = "âŒ Erro";
            resultMessage.textContent =
              error.message || "Erro inesperado. Verifique os logs no console.";
            resultDiv.querySelector(".result-content").className =
              "result-content result-error";
          } finally {
            ui.resetButton();
          }
        });

      // Inicializar
      updateCharCount();
      document
        .getElementById("email-textarea")
        .addEventListener("input", updateCharCount);

      console.log("âœ… Teste de email carregado - Pronto para testar!");
    </script>
  </body>
</html>
